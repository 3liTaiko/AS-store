document.addEventListener("DOMContentLoaded", function () {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const cartButtons = document.querySelectorAll(".add-to-cart");
    const orderModal = document.getElementById("order-modal");
    const orderForm = document.getElementById("order-form");
    const cartItemsContainer = document.getElementById("cart-items");
    const orderTotal = document.getElementById("order-total");
    const openCartBtn = document.getElementById("open-cart");
    const closeCartBtn = document.getElementById("close-cart");
    const confirmOrderButton = document.getElementById("confirm-order");
    const whatsappNumber = "201124147741";    
function switchLanguage(language) {
    // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙÙŠ LocalStorage
    localStorage.setItem("language", language);

    // ØªØºÙŠÙŠØ± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ©
    if (language === "ar") {
        document.body.setAttribute("dir", "rtl");
        document.body.classList.add("arabic");
    } else {
        document.body.setAttribute("dir", "ltr");
        document.body.classList.remove("arabic");
    }

    location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
}

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ø­Ø¯Ø¯ Ø§Ù„Ù„ØºØ© Ù…Ù† LocalStorage
document.addEventListener("DOMContentLoaded", function () {
    const language = localStorage.getItem("language") || "en"; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø¹Ø±Ø¨ÙŠ)
    switchLanguage(language);
});

    // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ©
    cartButtons.forEach(button => {
        button.addEventListener("click", function () {
            const productCard = button.parentElement;
            const productName = productCard.querySelector("h3").textContent;
            const productPrice = parseInt(productCard.querySelector(".price").textContent.replace(" Ø¬Ù†ÙŠÙ‡", ""));

            let existingProduct = cart.find(item => item.name === productName);

            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                cart.push({ name: productName, price: productPrice, quantity: 1 });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            showCart();
        });
    });

    // âœ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ù„Ø©
    openCartBtn.addEventListener("click", function () {
        showCart();
        orderModal.style.display = "block";
    });

    // âœ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
    closeCartBtn.addEventListener("click", function () {
        orderModal.style.display = "none";
    });

    // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ùˆ Ø§Ù„Ø­Ø°Ù
    function showCart() {
        cartItemsContainer.innerHTML = "";
        let total = 0;
        const shippingCost = 50; // Ù…ØµØ§Ø±ÙŠÙ Ø´Ø­Ù† Ø«Ø§Ø¨ØªØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
        let discount = 0; // Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø®ØµÙ… ÙÙŠÙ‡

        if (cart.length === 0) {
            cartItemsContainer.innerHTML = "<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©! ğŸ›’</p>";
            orderTotal.textContent = "";
            return;
        }

        cart.forEach((item, index) => {
            const itemElement = document.createElement("div");
            itemElement.classList.add("cart-item");
            itemElement.innerHTML = `
                <p>${item.name} - ${item.price} Ø¬Ù†ÙŠÙ‡</p>
                <input type="number" value="${item.quantity}" min="1" data-index="${index}" class="quantity-input">
                <button class="remove-item" data-index="${index}">âŒ</button>
            `;
            cartItemsContainer.appendChild(itemElement);

            total += item.price * item.quantity;
        });

        // âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ… Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù†ØªØ¬ÙŠÙ†
        if (cart.length >= 3) {
            discount = total * 0.10; // Ø®ØµÙ… 10%
        }

        const finalTotal = total + shippingCost - discount;

        orderTotal.innerHTML = `
            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${total} Ø¬Ù†ÙŠÙ‡</p>
            ${discount > 0 ? `<p>ğŸ‰ Ø®ØµÙ… 10%: -${discount} Ø¬Ù†ÙŠÙ‡</p>` : ""}
            <p>ğŸ“¦ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†: ${shippingCost} Ø¬Ù†ÙŠÙ‡</p>
            <p><strong>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${finalTotal} Ø¬Ù†ÙŠÙ‡</strong></p>
        `;

        // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ§Øª
        document.querySelectorAll(".quantity-input").forEach(input => {
            input.addEventListener("change", function () {
                const index = this.getAttribute("data-index");
                cart[index].quantity = parseInt(this.value);
                localStorage.setItem("cart", JSON.stringify(cart));
                showCart();
            });
        });

        // âœ… Ø­Ø°Ù Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
        document.querySelectorAll(".remove-item").forEach(button => {
            button.addEventListener("click", function () {
                const index = this.getAttribute("data-index");
                cart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
                showCart();
            });
        });
    }

    // âœ… ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    window.showPaymentDetails = function() {
        const paymentMethod = document.getElementById("payment-method").value;
        const allPaymentDetails = document.querySelectorAll(".payment-details");

        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹
        allPaymentDetails.forEach(detail => {
            detail.style.display = "none";
        });

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        if (paymentMethod) {
            const paymentDetailsElement = document.getElementById(paymentMethod + "-details");
            if (paymentDetailsElement) {
                paymentDetailsElement.style.display = "block";
            }
        }

        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
        const paymentProof = document.getElementById(`payment-proof-${paymentMethod}`);
        if (paymentMethod !== "cash") {
            if (paymentProof) {
                paymentProof.addEventListener("change", function () {
                    // âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
                    if (paymentProof.files.length > 0) {
                        confirmOrderButton.disabled = false;
                    } else {
                        confirmOrderButton.disabled = true;
                    }
                });
            }
        } else {
            confirmOrderButton.disabled = false;
        }
    };

    // âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
    orderForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const name = document.getElementById("customer-name").value;
        const phone = document.getElementById("customer-phone").value;
        const address = document.getElementById("customer-address").value;
        const paymentMethod = document.getElementById("payment-method").value;

        if (!name || !phone || !address || !paymentMethod) {
            alert("âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!");
            return;
        }

        // âœ… ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
        const paymentProof = document.getElementById(`payment-proof-${paymentMethod}`);
        if (paymentMethod !== "cash" && !paymentProof.files.length) {
            alert("âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ù‚Ù… Ø¨Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù‚Ø¨Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨!");
            return;
        }

        // âœ… ØªØ¬Ù‡ÙŠØ² Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        let paymentMessage = "";
        switch (paymentMethod) {
            case "visa":
                paymentMessage = `ğŸ’³ Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙŠØ²Ø§: [Ø¶Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙŠØ²Ø§ Ù‡Ù†Ø§]`;
                break;
            case "cash":
                paymentMessage = `ğŸ’µ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…`;
                break;
            case "wallet":
                paymentMessage = `ğŸ’¸ Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©: [Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‡Ù†Ø§]`;
                break;
            case "instapay":
                paymentMessage = `ğŸ” Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø¥Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ: [Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ Ù‡Ù†Ø§]`;
                break;
            default:
                paymentMessage = "âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹!";
        }

        const message = `ğŸ“¢ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${name}!\nğŸ“ Ù‡Ø§ØªÙ: ${phone}\nğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n\nğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n${cart.map(i => `${i.name} - ${i.price} Ø¬Ù†ÙŠÙ‡ Ã— ${i.quantity}`).join("\n")}\n\n${discount > 0 ? `ğŸ‰ Ø®ØµÙ… 10%: -${discount} Ø¬Ù†ÙŠÙ‡` : ""}\nğŸ“¦ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†: 50 Ø¬Ù†ÙŠÙ‡\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${cart.reduce((total, item) => total + item.price * item.quantity, 0) + 50 - discount} Ø¬Ù†ÙŠÙ‡\n\n${paymentMessage}`;

        // âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·
        const whatsappLink = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(whatsappLink, "_blank");

        // âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
        alert(`âœ… Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙŠØ§ ${name}! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.`);
        
        localStorage.removeItem("cart"); // Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨
        orderModal.style.display = "none";
    });
});
